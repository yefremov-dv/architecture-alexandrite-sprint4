# Task 2
---
### Проанализируйте систему компании и C4-диаграмму в контексте планирования мониторинга.

Ключевые претенденты на мониторинг напрямую зависят от текущих жалоб клиентов и пользователей. Обратимся к списку, составленному в первом задании. Остановимся на сервисах, связанных с заказом для покупателя, оператора MES и менеджера по продажам.

Для клиентов B2C и B2B:
- Internet Shop
- Shop API
- Shop DB
- MES API
- 3d file storage

Для менеджера по продажам:
- CRM
- CRM API

Для оператора:
- MES

Выделены наиболее приоритетные части ИТ-архитектуры для выявления причин поступающих жалоб.

---
### Добавьте в файл раздел «Мотивация».
> Напишите здесь, почему в систему нужно добавить мониторинг и что это даст компании.

Для презентации бизнес-подразделениям идеи внедрения мониторинга ИТ-командой были выделены следующие тезисы:
- Мониторинг поможет не терять заказы, которые еще не переданы в производство, что увеличит прибыль компании
- Мониторинг позволит лучше контролировать исполнение согласованных в производство заказов, что уменьшит число отказов недовольных по причине срыва сроков клиентов. Каждый невыполненный и/или выполенный частично заказ - прямой убыток компании
- Мониторинг позволит выяснить причины проблем, которые напрямую влияют на клиентский опыт. Устранение таких проблем поможет минимизировать репутационные риски и потенциально повысит лояльность клиентов

Т.к. внедрение мониторинга повлечет за собой дополнительные затраты, то ниже выделяются только ключевые по мнению ИТ-команды метрики с потенциалом дальнейшего расширения при необходимости.

---
### Добавьте раздел «Выбор подхода к мониторингу».
> Выберите, какой подход к мониторингу вы будете использовать: RED, USE или «Четыре золотых сигнала». Для разных частей системы можно использовать разные подходы.

По итогам совещания внутри ИТ-команды было решено использовать подход «Четыре золотых сигнала». Причины выбора:
- Метод золотых сигналов подходит любой системе, которая связана с предоставлением API (MES API, Shop API, CRM API)
- Метод USE не подходит из-за желания использовать в ближайшем будущем кеширование для MES системы
- Метод RED не подходит из-за использования пакетной обработки 3D-моделей заказов на MES API для B2B сегмента клиентов

Для унификации мониторинга было принято решение сосредоточиться на использовании одного подхода. В дальнейшем, после решения текущих проблем с жалобами клиентов, возможно дополнение и других методов для отдельных элементов ИТ-ландшафта «Александрита».

---
### Опишите, какие метрики и в каких частях системы вы будете отслеживать.
> Перед вами список метрик. Выберите метрики, которые вы считаете нужным отслеживать. Для выбранных метрик напишите:
>1. Зачем нужна эта метрика.
>2. Нужны ли ярлыки для этой метрики. Если ярлыки нужны, опишите, какие именно вы планируете добавить.
Вы можете не ограничивать себя только этим списком. Если вы видите, что стоит добавить какие-то ещё метрики, — добавьте и их тоже.

**Выделяем следующие метрики:**

Согласно выбраному методу мониторинга ключевые для нас показатели это: задежка, трафик, ошибки, насыщенность. Для данных показателей выберем метрики из перечня. Дополним метриками о статусе заказа и ярлыками для своевременного оповещения о DDoS-трафике

1. Internet Shop
    - Число заказов в статусе INITIATED, SUBMITTED
2. Shop API
    - Number of requests (RPS) for internet shop API
    - Number of requests (RPS) per user for internet shop API
        - Используется ярлык по IP привязке для избегания DDoS-атак со стороны злоумышленников
    - Response time (latency) for shop API
    - Number of HTTP 500 for shop API
    - Number of simultanious sessions for shop API
3. Shop DB
    - Изменение числа заказов по каждому статусу
4. 3d file storage
    - Число заказов в статусе FILE_UPLOADED
    - Size of S3 storage
5. CRM
    - Number of requests (RPS) per user for CRM API
    - Response time (latency) for CRM API
    - Число заказов в статусе MANUFACTURING_APPROVED, CLOSED
6. CRM API
    - Number of requests (RPS) for CRM API
    - Number of HTTP 500 for CRM API
    - Number of simultanious sessions for CRM API
7. MES
    - Number of requests (RPS) for MES API
    - Response time (latency) for MES API
    - Число заказов в статусе MANUFACTURING_STARTED, MANUFACTURING_COMPLETED, PACKAGING, SHIPPED
8. MES API
    - Number of requests (RPS) per user for MES API
        - Используется ярлык по IP привязке для избегания DDoS-трафика (от B2B партнеров, пускай и непреднамеренного)
    - Number of HTTP 500 for MES API
    - Число заказов в статусе PRICE_CALCULATED  
    - Number of simultanious sessions for MES API  

---
### Добавьте раздел «План действий».
> Напишите высокоуровнево, какие задачи вы видите для реализации. Это будет драфт технического задания. Например, «Создать инстанс time-series базы с использованием такой-то технологии».

Верхнеуровневый план, в контуре release:
1. Разворачиваем Prometheus и Grafana в облаке (согласно заданию инфраструктура компании уже переведена в облако)
2. Создаем и/или настраиваем экспортирующие модули в системах, с которых планируем собирать метрики
3. Запускаем тестовый сбор метрик, приведенных выше. Синтетически генерируем трафик
4. Создаем сервис алертинга для оповещения об инцидентах
5. Формируем панели и дешборды для отображения метрик в Grafana
6. При успешном тестировании, дулируем мониторинг в контуре prod

---