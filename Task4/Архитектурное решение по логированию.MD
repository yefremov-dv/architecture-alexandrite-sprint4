# Task 4
---
### Проанализируйте систему компании и C4-диаграмму в контексте планирования логирования.

> Опишите, какие логи нужно собирать и отметьте на схеме, из каких систем требуется сбор логов. Составьте список необходимых логов с уровнем INFO.
Например, изменение статуса заказа. Логируем время, идентификатор покупателя, номер заказа.
Напишите, будете ли вы использовать другие уровни логирования и при каких обстоятельствах

Реализуем логирование для ключевых элементов уровня INFO, связанных с заказом
- **Информация о заказе:** уникальный ID заказа; дата и время заказа; идентификатор покупателя; статус заказа; уникальный ID 3D модели; время на исполнение
- **Информация о 3D модели:** уникальный ID 3D модели; адрес в S3; дата последнего изменения; контрольная сумма файла, согласованного к производству; статус заказа;
- **Факт создания заказа:** дата и время; уникальный ID заказа; идентификатор покупателя; связанные ID 3D моделей; статус заказа;
- **Подсчет стоимости заказа:** ID заказа; стоимость;
- **Факт подтверждения заказа:** дата и время; уникальный ID заказа; идентификатор покупателя; связанные ID 3D моделей; статус заказа;
- **Старт выполнения заказа** дата и время; уникальный ID заказа; связанные ID 3D моделей; статус заказа;
- **Факт выполнения заказа** дата и время; уникальный ID заказа; статус заказа;
- **Факт упаковки заказа** дата и время; уникальный ID заказа; статус заказа;
- **Факт отправки заказа** дата и время; уникальный ID заказа; трек-номер посылки; статус доставки; статус заказа;
- **Факт завершения заказа** дата и время; уникальный ID заказа; трек-номер посылки; статус доставки; статус заказа;

Информация собирается из систем, где изменяется статус заказа согласно заданию: Internet Shop, MES, CRM.

Другие уровни логирования:
- FATAL - будет использоваться для событий на ключевых сервисах архитектуры для создания инцидентов недоступности
- ERROR - будет использоваться при отклонениях от стандартного поведения этапов заказа
- WARN - будет использоваться для логов событий безопасности и утилизации инфраструктуры
- DEBUG и TRACE - не будут использованы для PROD контура. Возможно использование для контуров Deploy и Release при необходимости в процессе разработки и/или тестирования


---
### Добавьте в файл раздел «Мотивация».

> Напишите здесь, почему в систему нужно добавить логирование и что это даст компании. Опишите три-пять технические и бизнес-метрики решения, на которые может повлиять внедрение логирования.
Команда не сможет реализовать единовременно логирование и трейсинг всех выделенных для этого систем. Поэтому опишите, для каких систем нужно настраивать логирование и трейсинг в первую очередь и почему.

Ключевые решения, которые поддержит внедрение логирования:
- Компания решила внедрить мониторинг процессов, для функционирования которого потребуется собирать логи с ключевой информацией
- Информация из логов также будет использоваться для формирования отчетности для бизнес-лидеров компании: всегда можно будет узнать сколько заказов в каком статусе находятся
- На основе информации из логов можно строить предиктивную аналитику спроса и прибыли компании
- Логи позволят детально проанализировать случаи потерь заказов ключевых партнеров для минимизации репутационных рисков (согласно заданию ряд ключевых партнеров B2B отказались от услуг "Александрита". Каждый инцидент исследовать невозможно, но для ключевых заказов это можнет быть хорошим подспорьем)

---
### Добавьте раздел «Предлагаемое решение».

> Опишите, как и с помощью каких технологий будет реализовано логирование, какие компоненты нужно внедрить или доработать. Отразите компоненты и новые связи на схеме.
Проработайте политику безопасности в отношении логов — как будет происходить работа с чувствительными данными, кто будет иметь доступ к логам.
Проработайте политику хранения в отношении логов — будет ли это отдельный индекс под систему, сколько они будут храниться и какого размера будут.

**Что необходимо внедрить**

- Logstash - конвейер данных
- Elasticsearch - хранилище данных для поиска и анализа
- Kibana - инструмент для визуализации

**Что необходимо доработать**
- Для систем, выбранных к сбору логов, внедряем на серверах агент по сбору данных семейства Beats - Filebeat

**Политика безопасности логов**
- Полный запрет на доступ к техническим логам систем для бизнес-пользователей. Бизнес-пользователи работают только с результирующими дешбордами Kibana в рамках своих должностных полномочий и должностных инструкций
- Доступ ИТ-специалистов к логам PROD контруа осуществляется только с целью поддержки работоспособности системы логирования с учетом ролевой модели
- При возникновении ИТ-инцидентов возможно предоставление временного доступа на ограниченную часть логов контура PROD для ИТ-команды, участвующей в разборе инцидента. С дальнейшим изъятием такого доступа

**Политики хранения логов**
ИТ-команда приняла решение воспользоваться лучшими практиками при составлении политики хранения логов:
- Для трех систем будет создано по одному собственному индексу
- Предельное значение размера сегмента - 30ГБ
- Проанализировав регуляторные требования и запросы бизнес-подразделений, было решено хранить логи 3 года с учетом сроков жизни заказа. ИТ-команда подтведила, что такой срок хранения возможно реализовать технически и это не повлечет за собой деградацию сервисов

**Схема архитектуры** расположена в текущей директории под названием *"jewerly_c4_model_logging.drawio"*

---
### Проработайте необходимые мероприятия для превращения системы сбора логов в систему анализа логов:

> Нужно ли настроить какой-то алертинг?
Нужно ли искать аномалии? Например, было четыре записи о создании заказов и за секунду их стало 10 000. Возможно, происходит DDoS-атака конкурентами.

Верхнеуровневый план:
- Подключаем модуль алертинга
- Формируем правила алертинга для основных направлений
    - Бизнес-инциденты (остановка производства, долгое отсутствие заказов, недоступность логистических партнеров, естественные экстремумы спроса)
    - ИТ-инциденты (недоступность инфраструктуры, систем, конкретной функциональности; скопление очередей на MQ; аномалии в работе сервисов)
    - Инциденты информационной безопасности (искуственные экстремумы спроса в результате атак; многократные попытки авторизации; подозрительные повторяющиеся наборы действий с одного/группы IP адресов)
    - Допонлительные триггеры по согласованию с подразделениями "Александрита" (например, уведомление о выполненении бизнес плана на определенный процент 25, 50, 75, 100)
- Создаем список рассылок и уведомлений для отправки событий алертинга


---